CREATE DATABASE KAAM_DAAM_DB;

CREATE TABLE Login(
Username TEXT PRIMARY KEY NOT NULL,
Password TEXT NOT NULL CHECK(LENGTH(Password) >= 8),
User_Type TEXT NOT NULL
);

CREATE TABLE Admin(
Admin_ID INT GENERATED BY DEFAULT AS IDENTITY,
Username TEXT NOT NULL UNIQUE,
Name TEXT NOT NULL,
Phone TEXT NOT NULL UNIQUE CHECK (LENGTH(Phone) > 10),
Email TEXT NOT NULL UNIQUE,
Address TEXT NOT NULL,
DOB Date NOT NULL,
Gender CHAR(1) NOT NULL,
Join_Date Date NOT NULL,
Profile_Pic BYTEA,
FOREIGN KEY(Username) REFERENCES Login(Username) ON DELETE CASCADE,
PRIMARY KEY(Admin_ID)
);


CREATE TABLE Employer(
Employer_ID INT GENERATED BY DEFAULT AS IDENTITY,
Username TEXT NOT NULL UNIQUE,
Name TEXT NOT NULL,
Phone TEXT NOT NULL UNIQUE CHECK (LENGTH(Phone) > 10),
Email TEXT NOT NULL UNIQUE,
Address TEXT NOT NULL,
DOB Date NOT NULL,
Gender CHAR(1) NOT NULL,
Join_Date Date NOT NULL,
Profile_Pic BYTEA,
FOREIGN KEY(Username) REFERENCES Login(Username) ON DELETE CASCADE,
PRIMARY KEY(Employer_ID)
);

CREATE TABLE Employee(
Employee_ID INT GENERATED BY DEFAULT AS IDENTITY,
Username TEXT NOT NULL UNIQUE,
Name TEXT NOT NULL,
Phone TEXT NOT NULL UNIQUE CHECK (LENGTH(Phone) > 10),
Email TEXT NOT NULL UNIQUE,
Address TEXT NOT NULL,
DOB Date NOT NULL,
Gender CHAR(1) NOT NULL,
CNIC_NO VARCHAR(13) NOT NULL UNIQUE CHECK(LENGTH(CNIC_NO) = 13),
Job_Type TEXT,
Join_Date Date NOT NULL,
Verified bool DEFAULT FALSE,
Rating numeric(3,2) DEFAULT 0, 
CNIC_IMG BYTEA,
Profile_Pic BYTEA,
FOREIGN KEY(Username) REFERENCES Login(Username) ON DELETE CASCADE,
PRIMARY KEY(Employee_ID)
);

CREATE TABLE Jobs (
Job_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
Title TEXT NOT NULL,
Description TEXT NOT NULL,
Job_Type TEXT NOT NULL,
Date_Posted DATE NOT NULL,
Salary MONEY NOT NULL,
Completed BOOL DEFAULT FALSE,
Employer_ID INT,
FOREIGN KEY(Employer_ID) REFERENCES Employer(Employer_ID) ON DELETE CASCADE
);

CREATE TABLE Applied_By (
Job_ID INT,
Employee_ID INT,
Hired BOOL DEFAULT FALSE,
FOREIGN KEY(Job_ID) REFERENCES Jobs(Job_ID) ON DELETE CASCADE,
FOREIGN KEY(Employee_ID) REFERENCES Employee(Employee_ID) ON DELETE CASCADE
);

-- For Testing 
INSERT INTO Login VALUES
('owais1', 'admin123', 'ADMIN')
('owais', 'admin123', 'ADMIN'),
('user', 'user1234', 'EMPLOYER'),
('saleem', 'saleem12', 'EMPLOYEE');

INSERT INTO ADMIN VALUES
(DEFAULT, 'owais', 'Syed Owais Ali','03007082321','owais@gmail.com','North Naz Karachi','5-12-2001','M',CURRENT_DATE);

INSERT INTO ADMIN VALUES
(DEFAULT ,'owais1', 'Syed Owais Ali','02001082321','o2a2s@gmail.com','North Naz Karachi','5-12-2001','M',CURRENT_DATE);

INSERT INTO Employer VALUES
(DEFAULT ,'user', 'Syed Owais Ali','02001082321','o2a2s@gmail.com','North Naz Karachi','5-12-2001','M',CURRENT_DATE);

INSERT INTO Employee VALUES
(DEFAULT ,'saleem', 'Syed Owais Ali','02001082321','o2a2s@gmail.com','North Naz Karachi','5-12-2001','M', '4210141703941','Cook',CURRENT_DATE,FALSE,0);

INSERT INTO JOBS VALUES
(DEFAULT, 'NEED A COOK IN EVENING', 'Urgently required a cook for my mother', 'CHEF/COOK', CURRENT_DATE, 5000,false, 1);

INSERT INTO Applied_By VALUES
(1,1);

SELECT * FROM JOBS J 
JOIN Applied_By A ON A.Job_ID = J.Job_ID;

SELECT * FROM Employee 
where Employee_ID in (SELECT Employee_ID From Applied_By Where Job_id = 1);

SELECT * FROM Login;
SELECT * FROM Admin;
SELECT * FROM Employer;
SELECT * FROM Employee;
SELECT * FROM JOBS;
SELECT * FROM Applied_BY;
